{"ast":null,"code":"import _defineProperty from \"/Users/feyraf/Desktop/projet Hkos/hkos-project-front/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport AddClientBlock from \"../AddClientBlock.vue\";\n\nclass lines {\n  constructor() {\n    _defineProperty(this, \"productName\", \"\");\n\n    _defineProperty(this, \"date\", \"\");\n\n    _defineProperty(this, \"units\", \"\");\n\n    _defineProperty(this, \"quantity\", \"\");\n\n    _defineProperty(this, \"htPrice\", \"\");\n\n    _defineProperty(this, \"tvaPercent\", \"\");\n\n    _defineProperty(this, \"finalPrice\", \"\");\n  }\n\n}\n\nexport default {\n  name: \"EditDevis\",\n  props: {\n    msg: String\n  },\n\n  data() {\n    return {\n      err: \"\"\n    };\n  },\n\n  methods: {\n    format(e) {\n      var key = e.key;\n\n      if (!/^\\d+/g.test(key) && key != \"Backspace\" && key != \"Delete\" && key != \"ArrowLeft\" && key != \"ArrowRight\") {\n        e.preventDefault();\n      }\n    },\n\n    addRow() {\n      this.$store.state.EditDevis.lines.push(new lines());\n    },\n\n    async sendForm() {\n      let res = await fetch(`${process.env.VUE_APP_ROOT_API}/devis/update/`, {\n        method: \"post\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(this.$store.state.EditDevis)\n      });\n      let data = await res.json();\n\n      if (data.message == \"Devis Updated\") {\n        this.$router.push(\"/Devis\");\n      } else {\n        this.err = data.error.message;\n      }\n    },\n\n    removeLast() {\n      if (this.$store.state.EditDevis.lines.length > 1) {\n        this.$store.state.EditDevis.lines.pop();\n      }\n    },\n\n    toggleModale: function (e) {\n      if (e) {\n        if (!e.target.closest(\".modale\") || e.target.id == \"close-btn\") this.revele = false;\n      } else this.revele = false;\n    },\n\n    getTotal() {\n      const Result = {\n        totalHT: 0,\n        totalTTC: 0,\n        totalTVA: 0\n      };\n\n      if (this.$store.state.EditDevis.lines) {\n        this.$store.state.EditDevis.lines.forEach(elem => {\n          Result.totalHT += elem.htPrice * elem.quantity;\n          Result.totalTTC += elem.finalPrice;\n          Result.totalTVA += elem.finalPrice - elem.htPrice * elem.quantity;\n        });\n      }\n\n      this.$store.state.EditDevis.totalHT = Result.totalHT.toFixed();\n      this.$store.state.EditDevis.totalTTC = Result.totalTTC.toFixed();\n      this.$store.state.EditDevis.totalTVA = Result.totalTVA.toFixed();\n      return Result;\n    },\n\n    getDate() {\n      let Result = \"\";\n\n      if (this.$store.state.EditDevis.dateReglement) {\n        Result = this.$store.state.EditDevis.dateReglement.substring(0, this.$store.state.EditDevis.dateReglement.length - 14);\n      }\n\n      this.$store.state.EditDevis.totalTVA == Result;\n      return Result;\n    }\n\n  },\n\n  mounted() {\n    this.$store.dispatch(\"getDevis\", {\n      uuid: this.$route.params.uuid\n    });\n    this.$store.dispatch(\"getClients\");\n  },\n\n  updated() {},\n\n  computed: {\n    getClients() {\n      return this.$store.state.Clients;\n    }\n\n  },\n  components: {\n    AddClientBlock\n  }\n};","map":{"version":3,"mappings":"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","names":["AddClientBlock","lines","name","props","msg","String","data","err","methods","format","e","key","test","preventDefault","addRow","$store","state","EditDevis","push","sendForm","res","fetch","process","env","VUE_APP_ROOT_API","method","headers","body","JSON","stringify","json","message","$router","error","removeLast","length","pop","toggleModale","target","closest","id","revele","getTotal","Result","totalHT","totalTTC","totalTVA","forEach","elem","htPrice","quantity","finalPrice","toFixed","getDate","dateReglement","substring","mounted","dispatch","uuid","$route","params","updated","computed","getClients","Clients","components"],"sourceRoot":"","sources":["/Users/feyraf/Desktop/projet Hkos/hkos-project-front/src/components/user/Devis/EditDevis.vue"],"sourcesContent":["<template>\n  <AddClientBlock\n    @accept=\"getForm\"\n    v-bind:revele=\"revele\"\n    v-bind:toggleModale=\"toggleModale\"\n  />\n\n  <div class=\"container\">\n    <div class=\"border-bottom d-flex justify-content-between\">\n      <span class=\"fw-normal\" style=\"font-size: 20px\">Modifier \"{{$store.state.EditDevis.reference}}\"</span>\n      <button class=\"btn btn-danger\" @click=\"$router.go(-1)\">Retour</button>\n    </div>\n\n    <div class=\"pb-2 mt-3\"><span>Client</span></div>\n\n    <div class=\"input-group pb-3 border-bottom\">\n      <button\n        class=\"btn-hkos\"\n        v-on:click=\"\n          $store.dispatch('toggleModal', { status: true, event: $event.target })\n        \"\n        id=\"open-modal\"\n      >\n        Nouveau client +\n      </button>\n      <select\n        class=\"form-control\"\n        style=\"font-weight: 300\"\n        v-model=\"$store.state.EditDevis.clientUuid\"\n        type=\"\"\n      >\n        <option :value=\"client.uuid\" v-for=\"client in getClients\" :key=\"client\">\n          {{ client.nom }} {{ client.prenoms }}\n        </option>\n      </select>\n    </div>\n\n    <div class=\"d-flex border-bottom pb-3 pt-3 row\">\n      <div class=\"w-50 col-lg\">\n        <div>\n          <label class=\"form-label\" for=\"inputDesctiption\">Commentaires</label>\n          <textarea\n            class=\"form-control\"\n            rows=\"4\"\n            v-model=\"$store.state.EditDevis.commentaires\"\n          ></textarea>\n        </div>\n      </div>\n      <div class=\"w-50 col-lg\">\n        <div class=\"pb-2\">\n          <label class=\"form-label\">Date limite de réglement </label>\n          <input\n            class=\"form-control\"\n            v-model=\"$store.state.EditDevis.dateReglement\"\n            type=\"date\"\n          />\n        </div>\n      </div>\n    </div>\n\n    <div class=\"table\">\n      <div\n        class=\"t-row row mt-2\"\n        id=\"devismainblock\"\n        v-for=\"row in $store.state.EditDevis.lines\"\n        :key=\"row\"\n      >\n        <div class=\"col-xl-4\" id=\"devismainblock\">\n          <label class=\"\">Description</label>\n          <input\n            class=\"form-control\"\n            v-model=\"row.productName\"\n            type=\"text\"\n            placeholder=\"Description\"\n          />\n        </div>\n        <div class=\"col\">\n          <label class=\"\">Date</label>\n          <input class=\"form-control\" v-model=\"row.date\" type=\"date\" />\n        </div>\n\n        <div class=\"col\">\n          <label class=\"\">Quantité</label>\n          <input\n            id=\"qty\"\n            class=\"form-control calc-inp maclasse\"\n            placeholder=\"Quantité\"\n            v-model=\"row.quantity\"\n            @keydown=\"format\"\n            type=\"number\"\n            step=\"1.0\"\n          />\n        </div>\n\n        <div class=\"col\">\n          <label class=\"\">Unité</label>\n          <select id=\"unit\" class=\"form-control\" type=\"\" v-model=\"row.units\">\n            <option value=\"PIECE\">Piéce(s)</option>\n            <option value=\"HEURE\">Heures</option>\n            <option value=\"KM\">Km</option>\n            <option value=\"KG\">Kg</option>\n            <option value=\"M\">M</option>\n            <option value=\"LOT_PARC\">Lot Parc</option>\n            <option value=\"AM\">Am</option>\n          </select>\n        </div>\n\n        <div class=\"col\">\n          <label class=\"\">Prix(€)</label>\n          <input\n            id=\"price\"\n            class=\"form-control calc-inp\"\n            type=\"number\"\n            placeholder=\"Prix\"\n            v-model=\"row.htPrice\"\n          />\n        </div>\n        <div class=\"col\">\n          <label class=\"\">TVA(%)</label>\n          <input\n            id=\"tax\"\n            class=\"form-control calc-inp\"\n            type=\"number\"\n            v-model=\"row.tvaPercent\"\n            @keydown=\"format\"\n            placeholder=\"TVA(%)\"\n            step=\"1\"\n          />\n        </div>\n\n        <div class=\"col\">\n          <label class=\"\">Montant(€)</label>\n          <input\n            class=\"form-control\"\n            type=\"points\"\n            :value=\"\n              (row.finalPrice =\n                row.quantity *\n                row.htPrice *\n                (1 + row.tvaPercent / 100)).toFixed(0)\n            \"\n            placeholder=\"0.00\"\n            step=\"0.1\"\n            readonly=\"readonly\"\n          />\n        </div>\n      </div>\n    </div>\n\n    <!-- Lines -->\n\n    <div class=\"mx-auto d-flex justify-content-between\">\n      <div>\n        <button\n          class=\"btn btn-light border mt-3\"\n          id=\"addbutton\"\n          type=\"button\"\n          @click=\"addRow\"\n        >\n          Ajouter +\n        </button>\n      </div>\n\n      <div>\n        <button @click=\"removeLast\" class=\"btn btn-light border mt-3\">\n          Supprimer -\n        </button>\n      </div>\n    </div>\n\n    <div>\n      <label class=\"mt-3 me-2\">Total HT(€)</label>\n      <input\n        style=\"border: none\"\n        type=\"number\"\n        placeholder=\"0.00\"\n        readonly=\"readonly\"\n        :value=\"getTotal().totalHT.toFixed(0)\"\n      />\n    </div>\n\n    <div>\n      <label class=\"mt-3 me-2\">Total TVA(€)</label>\n      <input\n        style=\"border: none\"\n        type=\"number\"\n        placeholder=\"0.00\"\n        readonly=\"readonly\"\n        :value=\"getTotal().totalTVA.toFixed(0)\"\n      />\n    </div>\n\n    <div>\n      <label class=\"mt-3 me-2\">Total TTC</label>\n      <input\n        id=\"amount\"\n        style=\"border: none\"\n        type=\"number\"\n        placeholder=\"0.00\"\n        readonly=\"readonly\"\n        :value=\"getTotal().totalTTC.toFixed(0)\"\n      />\n    </div>\n  </div>\n\n  <div id=\"notify\" class=\"text-danger\">{{ err }}</div>\n\n  <div class=\"d-flex justify-content-center m-4\">\n    <button\n      class=\"btn btn2 btn-danger\"\n      style=\"padding: 6px 18px;\"\n      @click=\"$router.go(-1)\"\n    >\n      Annuler\n    </button>\n    <button class=\"btn-hkos\" @click=\"sendForm\">Modifier mon devis</button>\n  </div>\n</template>\n\n<script>\nimport AddClientBlock from \"../AddClientBlock.vue\";\n\nclass lines {\n  productName = \"\";\n  date = \"\";\n  units = \"\";\n  quantity = \"\";\n  htPrice = \"\";\n  tvaPercent = \"\";\n  finalPrice = \"\";\n}\n\nexport default {\n  name: \"EditDevis\",\n  props: {\n    msg: String,\n  },\n\n  data() {\n    return {\n      err: \"\",\n    };\n  },\n  methods: {\n    format(e) {\n      var key = e.key;\n      if (\n        !/^\\d+/g.test(key) &&\n        key != \"Backspace\" &&\n        key != \"Delete\" &&\n        key != \"ArrowLeft\" &&\n        key != \"ArrowRight\"\n      ) {\n        e.preventDefault();\n      }\n    },\n    addRow() {\n      this.$store.state.EditDevis.lines.push(new lines());\n    },\n    async sendForm() {\n      let res = await fetch(`${process.env.VUE_APP_ROOT_API}/devis/update/`, {\n        method: \"post\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(this.$store.state.EditDevis),\n      });\n\n      let data = await res.json();\n      if (data.message == \"Devis Updated\") {\n        this.$router.push(\"/Devis\");\n      } else {\n        this.err = data.error.message;\n      }\n    },\n\n    removeLast() {\n      if (this.$store.state.EditDevis.lines.length > 1) {\n        this.$store.state.EditDevis.lines.pop();\n      }\n    },\n\n    toggleModale: function (e) {\n      if (e) {\n        if (!e.target.closest(\".modale\") || e.target.id == \"close-btn\")\n          this.revele = false;\n      } else this.revele = false;\n    },\n\n    getTotal() {\n      const Result = {\n        totalHT: 0,\n        totalTTC: 0,\n        totalTVA: 0,\n      };\n      if (this.$store.state.EditDevis.lines) {\n        this.$store.state.EditDevis.lines.forEach((elem) => {\n          Result.totalHT += elem.htPrice * elem.quantity;\n          Result.totalTTC += elem.finalPrice;\n          Result.totalTVA += elem.finalPrice - elem.htPrice * elem.quantity;\n        });\n      }\n      this.$store.state.EditDevis.totalHT = Result.totalHT.toFixed();\n      this.$store.state.EditDevis.totalTTC = Result.totalTTC.toFixed();\n      this.$store.state.EditDevis.totalTVA = Result.totalTVA.toFixed();\n\n      return Result;\n    },\n\n    getDate() {\n      let Result = \"\";\n      if (this.$store.state.EditDevis.dateReglement) {\n        Result = this.$store.state.EditDevis.dateReglement.substring(\n          0,\n          this.$store.state.EditDevis.dateReglement.length - 14\n        );\n      }\n      this.$store.state.EditDevis.totalTVA == Result;\n      return Result;\n    },\n  },\n  mounted() {\n    this.$store.dispatch(\"getDevis\", { uuid: this.$route.params.uuid });\n    this.$store.dispatch(\"getClients\");\n  },\n  updated() {},\n\n  computed: {\n    getClients() {\n      return this.$store.state.Clients;\n    },\n  },\n  components: {\n    AddClientBlock,\n  },\n};\n</script>\n\n<style scoped>\n* {\n  font-size: 14px;\n}\n</style>\n\n"]},"metadata":{},"sourceType":"module"}